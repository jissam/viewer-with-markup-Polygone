/*! For license information please see 301.js.LICENSE.txt */
"use strict";(self.webpackChunkviewer=self.webpackChunkviewer||[]).push([[301],{4301:(t,n,i)=>{i.r(n),i.d(n,{CommentsAnnotationPin:()=>p});var e=i(1949),o=(i(6425),i(4468)),a=(i(1604),i(9875)),s=i(3299),r=i(5390),l=(i(5022),i(5194));(0,l.i)();var d=(0,s.a)(r.e),c=[d.styles,e.h],p=class extends d{constructor(){super(),this.focusInput=()=>{var t,n;this.inputElement||(this.inputElement=null==(n=null==(t=this.shadowRoot)?void 0:t.querySelector("superviz-comments-comment-input"))?void 0:n.shadowRoot.querySelector("textarea")),this.inputElement.focus()},this.setInputSide=()=>{let t="right"===this.commentsSide?320:0,n=this.annotationSides.right+293,i=this.containerSides.right-t;if(n<i)return void(this.horizontalSide="right");t="left"===this.commentsSide?320:0;let e=this.annotationSides.left-293,o=this.containerSides.left+t;this.horizontalSide=e>o?"left":o-e>n-i?"right":"left"},this.createComment=({detail:t})=>{this.annotationSent=!0,document.body.dispatchEvent(new CustomEvent("create-annotation",{detail:(0,l.c)((0,l.b)({},t),{position:(0,l.c)((0,l.b)({},this.originalPosition),{type:"canvas"})})})),this.annotation=null},this.cancelTemporaryAnnotation=()=>{this.annotation=null},this.cancelTemporaryAnnotationEsc=t=>{this.annotation=null},this.avatar=()=>{if("add"===this.type&&!this.showInput)return r.a`<div
        class="comments__annotation-pin__avatar comments__annotation-pin__avatar--add"
      >
        <superviz-icon name="add"></superviz-icon>
      </div>`;let t=this.userAvatar;return t?r.a`<div class="comments__annotation-pin__avatar">
        <img src=${t} />
      </div>`:r.a`<div class="comments__annotation-pin__avatar">
      <p class="text text-bold text-big">${this.userInitial}</p>
    </div>`},this.input=()=>{if(this.showInput&&!this.annotationSent)return r.a`<div class="floating-input">
      <superviz-comments-comment-input
        @create-annotation=${this.createComment}
        eventType="create-annotation"
        @comment-input-ready=${this.focusInput}
        participantsList=${JSON.stringify(this.participantsList)}
      >
      </superviz-comments-comment-input>
    </div>`},this.position={x:0,y:0},setTimeout((()=>{this.firstLoad=!1}),800)}updated(t){super.updated(t),t.has("movedPosition")&&this.annotationSides&&(this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide(),this.inputElement&&this.focusInput())}firstUpdated(t){var n;super.firstUpdated(t),a.a.call(this,["comments"]),this.showInput&&(this.originalPosition=(0,l.b)({},this.position),this.pinAnnotation=null==(n=this.shadowRoot)?void 0:n.querySelector(".comments__annotation-pin"),this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide())}connectedCallback(){if(super.connectedCallback(),"add"!==this.type)return;let{localParticipant:t}=this.useStore("global-store");t.subscribe((t=>{var n;this.localAvatar=null==(n=null==t?void 0:t.avatar)?void 0:n.imageUrl,this.localName=null==t?void 0:t.name})),window.document.body.addEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.addEventListener("keyup",(t=>{"Escape"===t.key&&this.cancelTemporaryAnnotationEsc(t)}))}disconnectedCallback(){super.disconnectedCallback(),"add"===this.type&&(window.document.body.removeEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.removeEventListener("keyup",(t=>{"Escape"===t.key&&this.cancelTemporaryAnnotationEsc(t)})))}get userAvatar(){var t,n,i,e;return(null==(e=null==(i=null==(n=null==(t=this.annotation)?void 0:t.comments)?void 0:n.at(0))?void 0:i.participant)?void 0:e.avatar)||this.localAvatar}get userInitial(){var t,n,i,e,o;return((null!=(o=null==(e=null==(i=null==(n=null==(t=this.annotation)?void 0:t.comments)?void 0:n.at(0))?void 0:i.participant)?void 0:e.name)?o:this.localName)||"Anonymous")[0].toUpperCase()}emitClick(){var t;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:null==(t=this.annotation)?void 0:t.uuid}}))}render(){let t={"comments__annotation-pin":!0,preload:void 0===this.firstLoad,"comments__annotation-pin--active":this.active,"comments__cursor-pointer":"add"===this.type&&!this.showInput,"comments__annotation-pin--add":"add"===this.type&&this.showInput,[this.horizontalSide]:!0},n={"comments__annotation-pin-wrapper":!0,"comments__annotation-pin-wrapper--new":this.newPin},i=this.keepPositionRatio?"%":"px",e=`top: ${this.position.y}${i}; left: ${this.position.x}${i};`;return"add"===this.type?r.a`
        <div class=${(0,o.a)(t)} style=${e}>${this.avatar()} ${this.input()}</div>
      `:r.a`<div class=${(0,o.a)(n)} style=${e}>
      <div @click=${this.emitClick} class=${(0,o.a)(t)}>${this.avatar()}</div>
    </div> `}};p.styles=c,p.properties={type:{type:String},annotation:{type:Object},position:{type:Object},active:{type:Boolean},showInput:{type:Boolean},containerSides:{type:Object},horizontalSide:{type:String},commentsSide:{type:String},movedPosition:{type:String},pinAnnotation:{type:Object},localAvatar:{type:String},annotationSent:{type:Boolean},localName:{type:String},keepPositionRatio:{type:Boolean},participantsList:{type:Object},firstLoad:{type:Boolean},newPin:{type:Boolean}},p=(0,l.g)([(0,r.f)("superviz-comments-annotation-pin")],p)},9875:(t,n,i)=>{function e(t){let n=document.getElementById(`superviz-${t}-styles`);if(!n)return;let i=new CSSStyleSheet;i.replaceSync(n.textContent),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,i]}i.d(n,{a:()=>e}),(0,i(5194).i)()},1604:(t,n,i)=>{i.d(n,{a:()=>e,b:()=>o,c:()=>a}),(0,i(5194).i)();var e={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},o=t=>(...n)=>({_$litDirective$:t,values:n}),a=class{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,n,i){this._$Ct=t,this._$AM=n,this._$Ci=i}_$AS(t,n){return this.update(t,n)}update(t,n){return this.render(...n)}}},4468:(t,n,i)=>{i.d(n,{a:()=>s});var e=i(1604),o=i(5390),a=i(5194);(0,a.i)();var s=(0,e.b)(class extends e.c{constructor(t){var n;if(super(t),t.type!==e.a.ATTRIBUTE||"class"!==t.name||(null==(n=t.strings)?void 0:n.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter((n=>t[n])).join(" ")+" "}update(t,[n]){var i,e;if(void 0===this.st){this.st=new Set,void 0!==t.strings&&(this.nt=new Set(t.strings.join(" ").split(/\s/).filter((t=>""!==t))));for(let t in n)n[t]&&(null==(i=this.nt)||!i.has(t))&&this.st.add(t);return this.render(n)}let a=t.element.classList;for(let t of this.st)t in n||(a.remove(t),this.st.delete(t));for(let t in n){let i=!!n[t];i===this.st.has(t)||null!=(e=this.nt)&&e.has(t)||(i?(a.add(t),this.st.add(t)):(a.remove(t),this.st.delete(t)))}return o.b}});(0,a.i)()}}]);